<!DOCTYPE html>
<html lang="en"><head>
<link href="../course_logo.png" rel="icon" type="image/png">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.25">

  <title>Statistical Genetics – Lecture 03: Fitting Likelihoods, Linkage, and Association</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-b35a3bfecdac5fc8de409df89ff20628.css">
  <link rel="stylesheet" href="styles.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Lecture 03: Fitting Likelihoods, Linkage, and Association</h1>
  <p class="subtitle">PUBH 8878, Statistical Genetics</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="review-likelihood-function-basics" class="slide level2">
<h2>Review: Likelihood Function Basics</h2>
<ul>
<li>Likelihood function: <span class="math inline">\(L(\boldsymbol{\theta} \mid \text{data}) = P(\text{data} \mid \boldsymbol{\theta})\)</span></li>
<li>Maximum Likelihood Estimation (MLE)</li>
<li>Simple one-parameter examples</li>
</ul>
<p>However often direct MLE is not possible because</p>
<ul>
<li>Closed-form solution does not exist</li>
<li>Missing or latent data</li>
<li>High-dimensional or constrained parameter space leads to non-convex surface with multiple local maxima</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Let’s start by aligning on what <em>likelihood</em> means. We take the sampling model <span class="math inline">\(p(\text{data}\mid\theta)\)</span> and, after we’ve observed the data, we view it as a function of the parameter <span class="math inline">\(\theta\)</span>. That function is the likelihood <span class="math inline">\(L(\theta)\)</span>. The MLE is simply the value of <span class="math inline">\(\theta\)</span> that maximizes <span class="math inline">\(L\)</span>.</p>
<p>Two reminders that will be useful all semester: first, the <strong>invariance</strong> property—if <span class="math inline">\(\hat\theta\)</span> maximizes <span class="math inline">\(L(\theta)\)</span>, then <span class="math inline">\(g(\hat\theta)\)</span> maximizes the likelihood of <span class="math inline">\(g(\theta)\)</span>. Second, the <strong>curvature</strong> of the log-likelihood, via Fisher information, anticipates precision.</p>
<p>In practice, closed forms fail us for three common reasons: there’s no algebraic solution; there’s <strong>missing or latent data</strong>; or the parameter space is constrained or high-dimensional so the surface is bumpy. Today we’ll build the numerical toolkit that handles these realities.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="agenda" class="slide level2">
<h2>Agenda</h2>
<ul>
<li>Optimization for MLE: Newton–Raphson, Gradient Descent, SGD</li>
<li>EM algorithm: gene frequencies and incomplete data</li>
<li>Linkage analysis: two-point, unknown phase EM, multipoint HMM</li>
<li>Linkage disequilibrium (LD) and its measures (D, D’, r)</li>
<li>Association: single-marker/haplotype tests and basic QC</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Here’s the plan. We’ll warm up with Newton–Raphson and first‑order methods—how to actually <em>move</em> on a likelihood surface. We’ll then introduce EM as a principled way to deal with missing or latent pieces, anchored by an ABO example.</p>
<p>Next, we pivot to <strong>linkage</strong>: first two‑point LOD, then an EM formulation for <strong>unknown phase</strong>, and finally the multipoint <strong>HMM</strong> perspective. We’ll connect that to <strong>LD</strong>, clarify <span class="math inline">\(D\)</span>, <span class="math inline">\(D'\)</span> and <span class="math inline">\(r\)</span>, and finish with a single‑marker association demo and the <strong>QC</strong> that keeps results honest.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="newton-raphson-method-for-mle" class="slide level2">
<h2>Newton-Raphson Method for MLE</h2>
<ul>
<li>General procedure to find <span class="math inline">\(x\)</span> such that <span class="math inline">\(g(x) = 0\)</span></li>
<li>Uses Taylor Expansion, for <span class="math inline">\(g(x)\)</span> about a point <span class="math inline">\(x = a\)</span>:</li>
</ul>
<p><span class="math display">\[\begin{align*}
g(x) = g(a) &amp;+
\frac{g'(a)(x-a)}{1!} + \frac{g''(a)(x-a)^2}{2!} \\
&amp;+ ... + \frac{g^{(n)}(a)(x-a)^n}{n!}
\end{align*}\]</span></p>
<aside class="notes">
<p><strong>Script:</strong><br>
“In MLE we set <span class="math inline">\(g(\theta)=\ell'(\theta)\)</span>, the <strong>score</strong>, and look for a root. Newton’s update is<br>
\[ \theta<sup>{(t+1)}=</sup>{(t)}-.\]<br>
In multiple dimensions it’s <span class="math inline">\(\boldsymbol{\theta}^{(t+1)}=\boldsymbol{\theta}^{(t)}-\mathbf{H}^{-1}\mathbf{g}\)</span>, where <span class="math inline">\(\mathbf{g}\)</span> is the gradient and <span class="math inline">\(\mathbf{H}\)</span> the Hessian.</p>
<p>Three practical notes. First, Newton is <strong>quadratically convergent</strong> when you’re close to the solution—that’s why it’s fast. Second, guard against wild steps with <strong>damping or line search</strong>, and keep feasibility in mind if your parameter must lie on a simplex or in <span class="math inline">\([0,0.5]\)</span>. Third, if the Hessian misbehaves, use <strong>Fisher scoring</strong> (replace <span class="math inline">\(-\mathbf{H}\)</span> with expected information) or a <strong>trust region</strong>.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="gradient-descent" class="slide level2">
<h2>Gradient Descent</h2>
<ul>
<li>First-order iterative optimization algorithm</li>
<li>Does not rely on matrix inversions <span class="math inline">\(\longrightarrow\)</span> better for high dimensional problems</li>
<li><a href="https://uclaacm.github.io/gradient-descent-visualiser/#playground">Visualizer from UCLA</a></li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“First‑order methods move along the <strong>steepest descent</strong> direction without ever inverting a matrix. That’s a superpower in high‑dimensional genetics models where Hessians are huge. The tradeoff: convergence is typically <strong>linear</strong>, not quadratic.</p>
<p>What matters in practice is the <strong>step size</strong>: constant steps are brittle; backtracking or scheduled decay is safer. Stochastic and mini‑batch variants are essential when your objective decomposes over people, markers, or families. The mental model is simple: noisy but cheap steps that converge ‘on average’.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-em-algorithm" class="slide level2">
<h2>The EM Algorithm</h2>
<ul>
<li>Expectation-Maximization Algorithm</li>
<li>Key idea: transform an <strong>incomplete</strong> data problem into a <strong>complete</strong> data problem</li>
</ul>
<p><span class="math display">\[
p\left(y \mid \theta \right) = \frac{p\left(y, z \mid \theta \right)}{p\left(z \mid y, \theta\right)}
\]</span></p>
<aside class="notes">
<p><strong>Script:</strong><br>
“EM turns missingness into bookkeeping. We invent latent variables <span class="math inline">\(z\)</span> so that the <strong>complete‑data</strong> log-likelihood <span class="math inline">\(\log p(y,z\mid\theta)\)</span> is easy to maximize. At iterate <span class="math inline">\(t\)</span>:</p>
<ul>
<li><strong>E‑step:</strong> compute <span class="math inline">\(Q(\theta\mid\theta^{(t)})=\mathbb{E}_{z\mid y,\theta^{(t)}}[\log p(y,z\mid\theta)]\)</span>.<br>
</li>
<li><strong>M‑step:</strong> update <span class="math inline">\(\theta^{(t+1)}=\arg\max_\theta Q(\theta\mid\theta^{(t)})\)</span>.</li>
</ul>
<p>Why does it work? By Jensen’s inequality, EM <strong>monotonically increases</strong> the observed log-likelihood. The feel is ‘stable but sometimes slow’; we’ll flag accelerations like ECME and PX‑EM later.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="em-for-gene-frequencies" class="slide level2">
<h2>EM for Gene Frequencies</h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">Genotype</th>
<th style="text-align: left;">Phenotype</th>
<th style="text-align: left;">Observed Counts</th>
<th style="text-align: left;">Genotype Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(AA\)</span></td>
<td style="text-align: left;"><span class="math inline">\(A\)</span></td>
<td style="text-align: left;"><span class="math inline">\(n_A\)</span></td>
<td style="text-align: left;"><span class="math inline">\(p_A^2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(AO\)</span></td>
<td style="text-align: left;"><span class="math inline">\(A\)</span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\(2 p_A p_O\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(AB\)</span></td>
<td style="text-align: left;"><span class="math inline">\(AB\)</span></td>
<td style="text-align: left;"><span class="math inline">\(n_{AB}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(2 p_A p_B\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(BB\)</span></td>
<td style="text-align: left;"><span class="math inline">\(B\)</span></td>
<td style="text-align: left;"><span class="math inline">\(n_B\)</span></td>
<td style="text-align: left;"><span class="math inline">\(p_B^2\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(BO\)</span></td>
<td style="text-align: left;"><span class="math inline">\(B\)</span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\(2 p_B p_O\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(OO\)</span></td>
<td style="text-align: left;"><span class="math inline">\(O\)</span></td>
<td style="text-align: left;"><span class="math inline">\(n_O\)</span></td>
<td style="text-align: left;"><span class="math inline">\(p_O^2\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
<aside class="notes">
<p><strong>Script:</strong><br>
“Here’s the ABO mapping. The assumption is Hardy–Weinberg and random mating, so genotype frequencies are the usual <span class="math inline">\(p^2\)</span>, <span class="math inline">\(2pq\)</span>, <span class="math inline">\(q^2\)</span>. The ambiguity sits exactly in the <strong>A</strong> and <strong>B</strong> phenotypes: each collapses over two genotypes. EM will split those cells into expected counts using the current allele frequencies and then re‑estimate the frequencies as if those expected counts were observed.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="em-for-gene-frequencies-1" class="slide level2">
<h2>EM for Gene Frequencies</h2>
<ul>
<li>We don’t know if <span class="math inline">\(n_A\)</span> is from <span class="math inline">\(AA\)</span> or <span class="math inline">\(AO\)</span>! (And similarly for <span class="math inline">\(n_B\)</span>)</li>
<li>However, given our data model, we can find values of <span class="math inline">\((\hat{p}_A, \hat{p}_B)\)</span> via EM</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Think of each A phenotype as a <strong>soft label</strong> between AA and AO, with probabilities determined by the current <span class="math inline">\((p_A,p_O)\)</span>. Same story for B. That’s the essence of the E‑step.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="em-for-gene-frequencies-2" class="slide level2">
<h2>EM for Gene Frequencies</h2>
<ul>
<li><p>Start with initial <span class="math inline">\((p_A^{(0)}, p_B^{(0)})\)</span> and set <span class="math inline">\(p_O^{(0)} = 1 - p_A^{(0)} - p_B^{(0)}\)</span>.</p></li>
<li><p>E-step: allocate ambiguous phenotype counts:</p>
<ul>
<li><span class="math inline">\(A\)</span> phenotype: <span class="math inline">\(\tilde n_{AA} = n_A \frac{(p_A^{(t)})^2}{(p_A^{(t)})^2 + 2 p_A^{(t)} p_O^{(t)}}\)</span>, <span class="math inline">\(\tilde n_{AO} = n_A \frac{2 p_A^{(t)} p_O^{(t)}}{(p_A^{(t)})^2 + 2 p_A^{(t)} p_O^{(t)}}\)</span>.</li>
<li><span class="math inline">\(B\)</span> phenotype: <span class="math inline">\(\tilde n_{BB} = n_B \frac{(p_B^{(t)})^2}{(p_B^{(t)})^2 + 2 p_B^{(t)} p_O^{(t)}}\)</span>, <span class="math inline">\(\tilde n_{BO} = n_B \frac{2 p_B^{(t)} p_O^{(t)}}{(p_B^{(t)})^2 + 2 p_B^{(t)} p_O^{(t)}}\)</span>.</li>
</ul></li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“These are just conditional probabilities. Given the person has phenotype A, what’s the chance they’re AA versus AO under the current <span class="math inline">\((p_A,p_O)\)</span>? Multiply by <span class="math inline">\(n_A\)</span> to get <strong>expected</strong> genotype counts <span class="math inline">\(\tilde n_{AA}\)</span> and <span class="math inline">\(\tilde n_{AO}\)</span>. Do the same for B. That’s the E‑step.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="em-for-gene-frequencies-3" class="slide level2">
<h2>EM for Gene Frequencies</h2>
<ul>
<li>M-step (with <span class="math inline">\(N\)</span> total individuals):</li>
</ul>
<span class="math display">\[\begin{aligned}
p_A^{(t+1)} &amp;= \frac{2\tilde n_{AA} + \tilde n_{AO} + n_{AB}}{2N},\\
p_B^{(t+1)} &amp;= \frac{2\tilde n_{BB} + \tilde n_{BO} + n_{AB}}{2N},\\
p_O^{(t+1)} &amp;= 1 - p_A^{(t+1)} - p_B^{(t+1)}
\end{aligned}\]</span>
<ul>
<li>Iterate until parameter changes are below a tolerance.</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Now treat the expected genotype table as complete and <strong>recount alleles</strong>: two from each homozygote and one from each heterozygote, divided by <span class="math inline">\(2N\)</span>. That gives updated <span class="math inline">\((p_A,p_B,p_O)\)</span>. Iterate E and M until the changes are tiny and the observed log‑likelihood is no longer increasing.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="em-for-gene-frequencies-4" class="slide level2">
<h2>EM for Gene Frequencies</h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">Genotype</th>
<th style="text-align: left;">Phenotype</th>
<th style="text-align: left;">Observed Counts</th>
<th style="text-align: left;">Genotype Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(AA\)</span></td>
<td style="text-align: left;"><span class="math inline">\(A\)</span></td>
<td style="text-align: left;"><span class="math inline">\(725\)</span></td>
<td style="text-align: left;"><span class="math inline">\(p_A^2\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(AO\)</span></td>
<td style="text-align: left;"><span class="math inline">\(A\)</span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\(2 p_A p_O\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(AB\)</span></td>
<td style="text-align: left;"><span class="math inline">\(AB\)</span></td>
<td style="text-align: left;"><span class="math inline">\(72\)</span></td>
<td style="text-align: left;"><span class="math inline">\(2 p_A p_B\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(BB\)</span></td>
<td style="text-align: left;"><span class="math inline">\(B\)</span></td>
<td style="text-align: left;"><span class="math inline">\(258\)</span></td>
<td style="text-align: left;"><span class="math inline">\(p_B^2\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(BO\)</span></td>
<td style="text-align: left;"><span class="math inline">\(B\)</span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"><span class="math inline">\(2 p_B p_O\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(OO\)</span></td>
<td style="text-align: left;"><span class="math inline">\(O\)</span></td>
<td style="text-align: left;"><span class="math inline">\(1073\)</span></td>
<td style="text-align: left;"><span class="math inline">\(p_O^2\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
<aside class="notes">
<p><strong>Script:</strong><br>
“With these sample counts—A = 725, AB = 72, B = 258, O = 1073—we can run EM. I’ll show convergence behavior next, and I want you to notice two things: the <strong>monotone</strong> increase in log‑likelihood and the impact of <strong>starting values</strong>.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="em-starting-values-matter" class="slide level2">
<h2>EM: Starting Values Matter</h2>
<ul>
<li>Different initial <span class="math inline">\((p_A, p_B, p_O)\)</span> can change speed (not the final MLE)</li>
<li>Strategies:
<ul>
<li>Equal: <span class="math inline">\((1/3, 1/3, 1/3)\)</span></li>
<li>Unbalanced guess: <span class="math inline">\((0.01, 0.98, 0.01)\)</span></li>
<li>Smart (use <span class="math inline">\(p_O^{(0)} = \sqrt{n_O/N}\)</span>, solve for <span class="math inline">\((p_A^{(0)}, p_B^{(0)})\)</span> from <span class="math inline">\(2p_A p_B\)</span>)</li>
</ul></li>
<li>Tolerance of <span class="math inline">\(1 \times 10^{-6}\)</span></li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“The ‘smart start’ uses two near‑identities: <span class="math inline">\(n_O \approx N p_O^2\)</span> gives <span class="math inline">\(p_O^{(0)}\approx\sqrt{n_O/N}\)</span>; then <span class="math inline">\(n_{AB}\approx 2N p_A p_B\)</span> plus <span class="math inline">\(p_A+p_B=1-p_O^{(0)}\)</span> gives a quadratic for <span class="math inline">\((p_A^{(0)},p_B^{(0)})\)</span>. This gets you close to the basin of attraction and trims iterations substantially. Equal and wild unbalanced starts are good stress tests.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="em-starting-values-matter-1" class="slide level2">
<h2>EM: Starting Values Matter</h2>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">Strategy</th>
<th style="text-align: right;">Iterations</th>
<th style="text-align: right;"><span class="math inline">\(\hat{p}_A\)</span></th>
<th style="text-align: right;"><span class="math inline">\(\hat{p}_B\)</span></th>
<th style="text-align: right;"><span class="math inline">\(\hat{p}_O\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Equal</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.209131</td>
<td style="text-align: right;">0.080801</td>
<td style="text-align: right;">0.710068</td>
</tr>
<tr class="even">
<td style="text-align: left;">Smart</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.209131</td>
<td style="text-align: right;">0.080801</td>
<td style="text-align: right;">0.710068</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unbalanced</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.209131</td>
<td style="text-align: right;">0.080801</td>
<td style="text-align: right;">0.710068</td>
</tr>
</tbody>
</table>
</div>
</div>
<aside class="notes">
<p><strong>Script:</strong><br>
“Read this table left to right. Each row is a starting strategy; the last three columns are the converged allele frequency estimates. The point is not that the answers differ—they don’t—but that the <strong>iterations</strong> column can vary a lot. You can buy free speed by initializing intelligently.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="em-parameter-trajectories" class="slide level2">
<h2>EM Parameter Trajectories</h2>

<img data-src="lecture-03_files/figure-revealjs/unnamed-chunk-5-1.png" width="960" class="r-stretch"><aside class="notes">
<p><strong>Script:</strong><br>
“Here are the trajectories for <span class="math inline">\(p_A\)</span>. Different starts head toward the same fixed point, and the paths are smooth. If you ever see oscillation or jaggedness here, it’s a warning sign about numerical underflow or a bad update rule.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="when-does-em-fail" class="slide level2">
<h2>When does EM fail?</h2>
<ul>
<li><strong>Non-identifiability / flat likelihood</strong>: Ridges in segregation or linkage models; EM wanders or stalls.</li>
<li><strong>Local maxima &amp; starts</strong>: Multiple modes (e.g., mixture of penetrance classes); poor initialization traps EM.</li>
<li><strong>Boundary degeneracy</strong>: Rare allele/component weight driven to 0; variance or frequency estimates collapse.</li>
<li><strong>Model misspecification</strong>: Violated assumptions (e.g., Hardy-Weinberg, stratification) give misleading “convergence.”</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“EM is not magic. If your model is <strong>not identifiable</strong>, EM will happily march along a ridge forever. If the likelihood is <strong>multimodal</strong>, bad starts can trap you. Near <strong>boundaries</strong>—think vanishing allele frequency—updates can collapse and stick. And if assumptions like HWE are wrong, EM will converge…to the wrong place. The antidotes are multiple starts, likelihood profiling, and stress‑testing the assumptions.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="linkage-vs-association-testing" class="slide level2">
<h2>Linkage vs Association Testing</h2>
<ul>
<li>Linkage: Tracks co-segregation of markers and traits within families to map disease genes.
<ul>
<li>Null hypothesis: no linkage (independent assortment), <span class="math inline">\(\theta = 0.5\)</span>.</li>
</ul></li>
<li>Association: Tests for correlation between variants and traits in populations to pinpoint causal loci.
<ul>
<li>Null hypothesis: no association (e.g., <span class="math inline">\(\beta=0\)</span> or OR=1).</li>
</ul></li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Two mapping mindsets. <strong>Linkage</strong> works within families, asks whether a trait and a marker co‑segregate more than chance, and summarizes evidence on a <strong>centimorgan</strong> scale with LOD curves. It’s robust to population structure. <strong>Association</strong> works across unrelateds, tests regression coefficients or odds ratios, and resolves at <strong>kilobase</strong> scale, but is sensitive to confounding. We need both lenses.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="two-point-linkage-terms" class="slide level2">
<h2>Two-Point Linkage: Terms</h2>
<ul>
<li>Independent assortment (recall): when loci are unlinked, transmissions are independent and the chance a crossover separates them is <span class="math inline">\(\theta=0.5\)</span> (Mendel’s Second Law).</li>
<li>Informative transmission/meiosis: a parent <span class="math inline">\(\to\)</span> child transmission where the transmitting parent is heterozygous at the loci of interest and the genotypes allow us to tell whether a crossover occurred.
<ul>
<li>Example: parent <span class="math inline">\(Aa/Bb\)</span> transmits <span class="math inline">\(AB\)</span> or <span class="math inline">\(ab\)</span> (nonrecombinant) vs <span class="math inline">\(Ab\)</span> or <span class="math inline">\(aB\)</span> (recombinant).</li>
</ul></li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“An <strong>informative</strong> meiosis is one where you can tell whether a crossover happened. If the transmitting parent is not heterozygous at both loci, you can’t tell—so that meiosis doesn’t contribute information about <span class="math inline">\(\theta\)</span>.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="two-point-linkage-terms-1" class="slide level2">
<h2>Two-Point Linkage: Terms</h2>
<ul>
<li>Recombinant fraction <span class="math inline">\(\theta\)</span>: the probability that a crossover occurs between two loci in a single meiosis; <span class="math inline">\(0 \le \theta \le 0.5\)</span>.</li>
<li>Nonrecombinant transmission: the child receives an allele combination that matches one of the transmitting parent’s original allele pairs (no crossover between the loci).</li>
<li>Recombinant transmission: the child receives a new combination relative to the transmitting parent’s original pair (a crossover occurred between the loci).</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Operationally, <strong>nonrecombinants</strong> copy one of the parental haplotypes; <strong>recombinants</strong> mix them. Our complete‑data likelihoods will be binomial in the counts of these two outcomes.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="two-point-linkage-repulsion-vs-coupling" class="slide level2">
<h2>Two-Point Linkage: Repulsion vs Coupling</h2>

<img data-src="images/paste-8.png" class="r-stretch"><aside class="notes">
<p><strong>Script:</strong><br>
“Phase matters. In <strong>coupling</strong>, <span class="math inline">\(AB/ab\)</span>, nonrecombinants are <span class="math inline">\(\{AB,ab\}\)</span> and recombinants are <span class="math inline">\(\{Ab,aB\}\)</span>. In <strong>repulsion</strong>, <span class="math inline">\(Ab/aB\)</span>, those roles flip. When phase is unknown, we’ll treat it as <strong>latent</strong> and estimate a posterior weight on the two configurations.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="two-point-linkage-direct-counting" class="slide level2">
<h2>Two-Point Linkage: Direct Counting</h2>
<ul>
<li><p>Count <span class="math inline">\(R\)</span> recombinants and <span class="math inline">\(NR\)</span> nonrecombinants; total informative <span class="math inline">\(I=R+NR\)</span>.</p></li>
<li><p>Point estimate: <span class="math inline">\(\hat{\theta}=R/I\)</span>.</p></li>
<li><p>LOD from counts (vs.&nbsp;independence at <span class="math inline">\(\theta=0.5\)</span>):</p></li>
</ul>
<p><span class="math display">\[
\mathrm{LOD}(\theta) = \log_{10}\!\left\{ \frac{\theta^{R} (1-\theta)^{NR}}{0.5^{I}} \right\}
\]</span></p>
<ul>
<li>This is a likelihood ratio test!</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“In the simplest case, count recombinants <span class="math inline">\(R\)</span> and informatives <span class="math inline">\(I\)</span>, and compute <span class="math inline">\(\hat\theta=R/I\)</span>. The LOD is a base‑10 log likelihood ratio against <span class="math inline">\(\theta=0.5\)</span>. The curve peaks at <span class="math inline">\(\hat\theta\)</span> and tells you where the evidence lies.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="worked-example-direct-counting-lod" class="slide level2">
<h2>Worked Example: Direct Counting LOD</h2>
<ul>
<li>Suppose <span class="math inline">\(I=40\)</span> informative meioses with <span class="math inline">\(R=12\)</span> recombinants.</li>
<li>MLE <span class="math inline">\(\hat{\theta}=R/I=12/40=0.3\)</span>.</li>
<li>For <span class="math inline">\(\theta=0.3\)</span></li>
</ul>
<p><span class="math display">\[
\mathrm{LOD}(0.3) = \log_{10}\!\left\{ \frac{0.3^{12} \cdot 0.7^{28}}{0.5^{40}} \right\}.
\]</span></p>
<aside class="notes">
<p><strong>Script:</strong><br>
“With <span class="math inline">\(R=12\)</span> out of <span class="math inline">\(I=40\)</span>, <span class="math inline">\(\hat\theta=0.30\)</span>. Plugging into the LOD gives about <span class="math inline">\(1.43\)</span>, i.e., roughly 27:1 odds for linkage at the MLE. That’s suggestive, but below the classical <span class="math inline">\(LOD\ge 3\)</span> bar. Modern practice often uses permutation‑based thresholds instead of a hard rule.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="worked-example-direct-counting-lod-1" class="slide level2">
<h2>Worked Example: Direct Counting LOD</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>R <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb1-2"><a></a>N <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb1-3"><a></a>thetahat <span class="ot">&lt;-</span> R <span class="sc">/</span> N</span>
<span id="cb1-4"><a></a></span>
<span id="cb1-5"><a></a>lod <span class="ot">&lt;-</span> <span class="fu">log10</span>((thetahat<span class="sc">^</span>R <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> thetahat)<span class="sc">^</span>(N <span class="sc">-</span> R)) <span class="sc">/</span> (<span class="fl">0.5</span><span class="sc">^</span>N))</span>
<span id="cb1-6"><a></a>lod</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.4294</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="dv">10</span><span class="sc">^</span>lod</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26.87819</code></pre>
</div>
</div>
<ul>
<li>Maximize <span class="math inline">\(\mathrm{LOD}(\theta)\)</span> over <span class="math inline">\(\theta \in [0,0.5]\)</span> to estimate the recombination fraction; <span class="math inline">\(LOD \ge 3\)</span> and <span class="math inline">\(\leq -2\)</span> are classic heuristics (context-dependent).</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“This code reproduces the arithmetic: LOD around 1.43, odds around 27:1. The maximizer of the LOD is exactly <span class="math inline">\(R/I\)</span>. The <span class="math inline">\(\pm\)</span> thresholds are heuristics, not laws—use context and proper genome‑wide calibration.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="worked-example-direct-counting-lod-2" class="slide level2">
<h2>Worked Example: Direct Counting LOD</h2>
<ul>
<li>Under <span class="math inline">\(H_0:\theta=0.5\)</span> (a boundary point), <span class="math inline">\(D = 2\ln(10)\cdot \mathrm{LOD}(\hat\theta)\)</span> has the mixture limit <span class="math inline">\(\tfrac{1}{2}\chi^2_0 + \tfrac{1}{2}\chi^2_1\)</span>; thus <span class="math inline">\(p = \tfrac{1}{2}\, \Pr(\chi^2_1 \ge D)\)</span>.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>D <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">10</span>) <span class="sc">*</span> lod</span>
<span id="cb5-2"><a></a>pval <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">pchisq</span>(D, <span class="at">df =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-3"><a></a>pval</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.005148931</code></pre>
</div>
</div>
<aside class="notes">
<p><strong>Script:</strong><br>
“At the <strong>boundary</strong> <span class="math inline">\(\theta=0.5\)</span>, Wilks’ theorem gives a <strong>mixture</strong> null: half the mass at zero degrees of freedom and half at one. Concretely, compute <span class="math inline">\(D=2\ln(10)\cdot \mathrm{LOD}\)</span> and take <span class="math inline">\(p=\tfrac{1}{2}\Pr(\chi^2_1\ge D)\)</span>. This is the right conversion for two‑point tests against <span class="math inline">\(\theta=0.5\)</span>.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="two-point-linkage-em-with-unknown-phase" class="slide level2">
<h2>Two-Point Linkage: EM with Unknown Phase</h2>
<ul>
<li>Transmitting parent: <strong>double het</strong> <span class="math inline">\(Aa/Bb\)</span> with <strong>unknown phase</strong>.</li>
<li>Mate: <strong>Aa/bb</strong> (heterozygous at <span class="math inline">\(A\)</span>, homozygous at <span class="math inline">\(B\)</span>).<br>
</li>
<li>Observed per child: two-locus <strong>genotypes</strong> <span class="math inline">\((A\text{-genotype}, B\text{-genotype})\)</span>.</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Now a case where EM is <strong>actually necessary</strong>. The mate is <strong>bb</strong>, so the child’s <span class="math inline">\(B\)</span> allele comes entirely from the transmitting parent. That’s helpful. But the mate is <strong>Aa</strong> at <span class="math inline">\(A\)</span>, so whenever a child is <strong>Aa</strong>, we can’t tell whether the transmitting parent contributed <span class="math inline">\(A\)</span> or <span class="math inline">\(a\)</span>. Those are <strong>ambiguous transmissions</strong> between two haplotypes—exactly the kind of soft labeling EM was built for.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="two-point-linkage-em-with-unknown-phase-1" class="slide level2">
<h2>Two-Point Linkage: EM with Unknown Phase</h2>
<ul>
<li>Missing-data view: the parental phase (coupling vs repulsion) is not observed. We make it a complete-data problem by introducing a weight <span class="math inline">\(w\in[0,1]\)</span> that blends the two phase-specific models.</li>
<li>Model (given recombination fraction <span class="math inline">\(\theta\)</span>):
<ul>
<li>Coupling: <span class="math inline">\(P(\text{NR})=1-\theta\)</span>, <span class="math inline">\(P(\text{R})=\theta\)</span> (split equally across the two categories).</li>
<li>Repulsion: <span class="math inline">\(P(\text{NR})=\theta\)</span>, <span class="math inline">\(P(\text{R})=1-\theta\)</span>.</li>
</ul></li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Think of <strong>phase</strong> as a two‑component latent class: coupling vs repulsion. We’ll carry a single scalar, <span class="math inline">\(w\)</span>, the posterior weight on coupling. Under coupling, nonrecombinants are more likely by <span class="math inline">\(1-\theta\)</span>; under repulsion the roles swap. EM will update <span class="math inline">\(w\)</span> and then update <span class="math inline">\(\theta\)</span> from <strong>weighted</strong> recombinant counts.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="two-point-linkage-em-with-unknown-phase-2" class="slide level2">
<h2>Two-Point Linkage: EM with Unknown Phase</h2>
<p>E-step (update the phase weight)</p>
<p><span class="math display">\[
w = \frac{(1-\theta^{(t)})^{\,n_{\text{NR}}}\,(\theta^{(t)})^{\,n_{\text{R}}}}
{(1-\theta^{(t)})^{\,n_{\text{NR}}}\,(\theta^{(t)})^{\,n_{\text{R}}} + (\theta^{(t)})^{\,n_{\text{NR}}}\,(1-\theta^{(t)})^{\,n_{\text{R}}}}
\]</span></p>
<p>and use <span class="math inline">\(1-w\)</span> as the weight on the repulsion configuration.</p>
<aside class="notes">
<p><strong>Script:</strong><br>
“This is the <strong>posterior</strong> weight on coupling: likelihood under coupling divided by the sum of likelihoods under both phases. In code, use logs and a log‑sum‑exp trick to avoid underflow if <span class="math inline">\(n_{\text{NR}}\)</span> or <span class="math inline">\(n_{\text{R}}\)</span> is large.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p>M-step (update <span class="math inline">\(\theta\)</span>)</p>
<p><span class="math display">\[\begin{align*}
\theta^{(t+1)}
&amp;= \frac{\text{(weighted recombinants)}}{N}
= \frac{w\,n_{\text{R}} + (1-w)\,n_{\text{NR}}}{N}.
\end{align*}\]</span></p>
<aside class="notes">
<p><strong>Script:</strong><br>
“The M‑step is ‘recombinants over informatives’, but with a twist: we average the recombinant counts under coupling and repulsion using the current <span class="math inline">\(w\)</span>. That keeps the intuition intact.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="from-two-point-em-to-multipoint" class="slide level2">
<h2>From Two-Point EM to Multipoint</h2>
<ul>
<li>Same objective: estimate recombination while marginalizing over latent transmissions/phase under current <span class="math inline">\(\theta\)</span>.</li>
<li>E-step engine: compute required state weights via Elston–Stewart peeling (pedigrees) or Lander–Green forward–backward (marker HMM) when you have multiple markers and missing genotypes.</li>
<li>Quantities needed: <span class="math inline">\(\mathbb E[\#\,\text{recombinants between adjacent markers}]\)</span> and <span class="math inline">\(\mathbb E[\#\,\text{informative transmissions}]\)</span> under current map.</li>
<li>Use in practice: either (a) plug these expectations into an EM-style update, or (b) more commonly, scan positions to build a LOD curve and report peak and 1-LOD interval.</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“In multipoint linkage, the hidden object is the <strong>inheritance state</strong> along the chromosome. The forward–backward algorithm gives us posterior state probabilities; from those we compute expected <strong>recombinant counts between markers</strong> and assemble LOD curves across the map. It’s the same EM logic, just powered by an HMM.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="multipoint-linkage-hmm" class="slide level2">
<h2>Multipoint Linkage (HMM)</h2>
<ul>
<li>Markers along a chromosome define an HMM over inheritance states; adjacent recombination rates drive transitions.</li>
<li>Combine penetrance with the marker HMM to compute <span class="math inline">\(L(\theta)\)</span> efficiently as you slide along the map (forward–backward yields the needed state probabilities even with missing phase/genotypes).</li>
<li>Pros: more information than two-point; better localization. Cons: requires a genetic map and error modeling.</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Two practical cautions: include a <strong>genotyping‑error model</strong>—even a small error rate flattens LODs if ignored—and consider sex‑specific maps or interference if your study demands it. Otherwise, the HMM machinery scales cleanly.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="missing-data-em-in-linkage" class="slide level2">
<h2>Missing-Data EM in Linkage</h2>
<ul>
<li>Complete data: informative meioses labeled as recombinant/nonrecombinant; incomplete data: untyped genotypes/phase.</li>
<li>E-step: compute <span class="math inline">\(E[\text{\# recombinants}]\)</span> and <span class="math inline">\(\mathrm E[\text{\# informative meioses}]\)</span> given current <span class="math inline">\(\theta^{(t)}\)</span> via peeling/HMM.</li>
<li>M-step: <span class="math inline">\(\displaystyle \theta^{(t+1)} = \frac{\mathrm E[R\mid\text{data},\theta^{(t)}]}{\mathrm E[I\mid\text{data},\theta^{(t)}]}\)</span>.</li>
<li>Iterate across <span class="math inline">\(\theta\)</span> grid to produce a LOD curve; maximize or report support interval.</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“This slide distills the recipe: compute <strong>expected</strong> recombinants and informatives under the current map, then update <span class="math inline">\(\theta\)</span> as their ratio. In practice we report the <strong>LOD curve</strong> and a 1‑LOD support interval rather than a single point estimate.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="practical-issues-in-linkage" class="slide level2">
<h2>Practical Issues in Linkage</h2>
<ul>
<li>Model specification: penetrance, phenocopy, allele frequencies; misspecification can distort LOD.</li>
<li>Marker selection: highly polymorphic markers increase information; account for sex-specific recombination if needed.</li>
<li>Computational trade-offs: many markers and large pedigrees require approximations or pruning; consider parametric vs nonparametric linkage.</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Linkage analyses are only as good as their <strong>trait model</strong>. Probe sensitivity to penetrance and phenocopy. Use polymorphic markers to maximize information, and thin dense SNPs if LD bloats state spaces. For large pedigrees, Elston–Stewart pruning is your friend.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="linkage-disequilibrium" class="slide level2">
<h2>Linkage Disequilibrium</h2>
<ul>
<li>Let alleles at two markers be denoted <span class="math inline">\(A, a\)</span> and <span class="math inline">\(B, b\)</span></li>
<li>Define allele frequencies by <span class="math inline">\(P_A, P_a, P_B, P_b\)</span></li>
<li>Define frequencies of haplotypes as <span class="math inline">\(P_{AB}, P_{Ab}, P_{aB}, P_{ab}\)</span></li>
<li>Define linkage equilibrium as independence in the <span class="math inline">\(2 \times 2\)</span> table
<ul>
<li>For example, <span class="math inline">\(P_{AB} = P_A \times P_B\)</span></li>
</ul></li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“LD is simply <strong>statistical dependence</strong> between alleles on the same haplotype. Think forces: drift and finite population size create dependence, recombination erodes it, selection and admixture can inflate it.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="linkage-disequilibrium-1" class="slide level2">
<h2>Linkage Disequilibrium</h2>
<ul>
<li>Define the LD coefficient as <span class="math inline">\(D\)</span></li>
</ul>
<p><span class="math display">\[D = p_{AB} - p_A p_B\]</span></p>
<ul>
<li>What are we looking at here?</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Algebraically, <span class="math inline">\(D\)</span> is the <strong>covariance</strong> between the allele indicators on a random haplotype. If <span class="math inline">\(D&gt;0\)</span>, <span class="math inline">\(AB\)</span> is over‑represented relative to independence; if <span class="math inline">\(D&lt;0\)</span>, it’s under‑represented.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="linkage-disequilibrium-2" class="slide level2">
<h2>Linkage Disequilibrium</h2>
<ul>
<li>Define the LD coefficient as <span class="math inline">\(D\)</span></li>
</ul>
<p><span class="math display">\[D = p_{AB} - p_A p_B\]</span></p>
<ul>
<li>Note that
<ul>
<li><span class="math inline">\(\operatorname{E}[A] = p_A, \operatorname{E}[B] = p_B\)</span></li>
<li><span class="math inline">\(\operatorname{E}[AB] = p_{AB}\)</span></li>
<li><span class="math inline">\(\operatorname{Cov}(A, B) = \operatorname{E}[AB] - \operatorname{E}[A]\operatorname{E}[B]\)</span></li>
</ul></li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Formalizing that intuition: let <span class="math inline">\(A,B\in\{0,1\}\)</span> indicate the presence of alleles on a haplotype. Then <span class="math inline">\(D=\operatorname{Cov}(A,B)\)</span>. This is why correlation <span class="math inline">\(r\)</span> shows up naturally on the next slide.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="linkage-disequilibrium-3" class="slide level2">
<h2>Linkage Disequilibrium</h2>
<ul>
<li><span class="math inline">\(D\)</span>, or <span class="math inline">\(\operatorname{Cov}(A, B)\)</span>, is scale-dependent</li>
<li>Normalized measures:
<ul>
<li><span class="math inline">\(D' = D / D_{\max}\)</span>, where <span class="math inline">\(D_{\max} = \min(p_A p_b, p_a p_B)\)</span> if <span class="math inline">\(D &gt; 0\)</span></li>
<li>Pearson correlation:</li>
</ul></li>
</ul>
<p><span class="math display">\[\begin{align}
r
&amp;= \frac{\operatorname{Cov}(A, B)}{\sqrt{\operatorname{Var}(A) \operatorname{Var}(B)}} \\
&amp;= \frac{D}{\sqrt{p_A(1 - p_A) p_B(1 - p_B)}}
\end{align}\]</span></p>
<aside class="notes">
<p><strong>Script:</strong><br>
“<span class="math inline">\(D\)</span> depends on allele frequencies, so we normalize. Two popular choices: <span class="math inline">\(D'\)</span> and <span class="math inline">\(r\)</span>. For <strong>association power</strong>, <span class="math inline">\(r\)</span>—and really <span class="math inline">\(r^2\)</span>—matters most because it directly scales the noncentrality parameter: effect sizes at a tag SNP are attenuated by about <span class="math inline">\(r\)</span> relative to the causal.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="goal-of-association-ld-link" class="slide level2">
<h2>Goal of Association &amp; LD Link</h2>
<ul>
<li>Goal: test the null of no effect (e.g., <span class="math inline">\(\beta=0\)</span> or OR<span class="math inline">\(=1\)</span>) to identify regions harboring causal variants.</li>
<li>We test markers, not necessarily the causal variant. If a marker has nonzero LD (correlation <span class="math inline">\(r\)</span>) with a causal variant, its association test can detect signal from that causal.</li>
<li>Stronger <span class="math inline">\(|r|\)</span> implies a stronger expected signal at the marker; if <span class="math inline">\(r\approx 0\)</span>, the marker carries no information about that causal.</li>
<li>Sign matters: <span class="math inline">\(r&lt;0\)</span> flips the observed effect direction at the marker relative to the causal.</li>
<li>In practice, nearby markers within LD blocks show clustered p-values and similar effect signs.</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Here’s the bridge: association tests fire at <strong>markers</strong>. If a marker correlates with a causal by <span class="math inline">\(r\)</span>, the observed effect is roughly <span class="math inline">\(r\)</span> times the causal effect, and power scales with <span class="math inline">\(r^2\)</span>. That’s why p‑values cluster within LD blocks and why effect <strong>signs</strong> can flip if <span class="math inline">\(r&lt;0\)</span>.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="single-marker-association-core-test-linear" class="slide level2">
<h2>Single-Marker Association: Core Test (Linear)</h2>
<ul>
<li>Linear trait: <span class="math inline">\(Y=\alpha+\beta G+\gamma^T C+\varepsilon\)</span>; test <span class="math inline">\(H_0{:}\,\beta=0\)</span>.</li>
<li>Genotype encodings: additive (0/1/2) or genotypic (AA/Aa/aa); include dominance to test non-additivity.</li>
<li>Binary outcomes (case–control) and logistic models will be covered later.</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Regression 101 with genetics details. Code genotypes additively unless biology suggests dominance or recessivity; add a dominance term if you want to test non‑additivity. Always include relevant covariates—sex, age, and <strong>PCs</strong> for ancestry—because stratification can fake associations.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="basic-qc-pipeline-variant-level" class="slide level2">
<h2>Basic QC Pipeline (Variant-level)</h2>
<ul>
<li>Call rate/missingness (e.g., variant missingness &lt; 2%).</li>
<li>Hardy–Weinberg equilibrium in controls (e.g., P &gt; 1e−6), mindful of true deviations.</li>
<li>Minor allele frequency threshold (e.g., MAF ≥ 0.01 unless rare-variant methods used).</li>
<li>Differential missingness across case/control; strand/allele checks.</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“QC is prevention. Missingness filters remove low‑quality sites; HWE in <strong>controls</strong> flags genotyping problems; MAF thresholds avoid unstable estimates unless you’re using rare‑variant methods. Don’t forget <strong>strand and allele</strong> checks—mismatches there create phantom effects.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="basic-qc-pipeline-sample-level" class="slide level2">
<h2>Basic QC Pipeline (Sample-level)</h2>
<ul>
<li>Sample call rate; sex checks from X chr; heterozygosity outliers.</li>
<li>Relatedness/duplicates via IBD; ancestry via PCA; remove outliers or adjust with PCs.</li>
<li>Duplicates/cryptic relatedness: retain one per pair or use mixed models.</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“At the sample level, verify <strong>sex</strong> against X‑chromosome heterozygosity, look for <strong>heterozygosity outliers</strong>, and identify relatives with IBD. Use PCA to quantify ancestry and either exclude outliers or adjust downstream. Mixed models help with relatedness, but don’t use them as an excuse to skip QC.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="summary-key-takeaways" class="slide level2">
<h2>Summary &amp; Key Takeaways</h2>
<ul>
<li>Likelihood optimization: Newton–Raphson (score/Hessian), Gradient Descent/SGD (scalable), and EM (latent-data) are core tools.</li>
<li>EM for ABO gene frequencies: initialization affects speed; log-likelihood increases monotonically until convergence.</li>
<li>Linkage: two-point LOD and unknown phase via EM; multipoint mapping framed as an HMM for efficient inference with missing data.</li>
<li>LD basics: r and r^2 quantify correlation between markers and explain why nearby markers can show similar association signals when a causal variant is unobserved</li>
</ul>
<aside class="notes">
<p><strong>Script:</strong><br>
“Take‑home messages. Newton and first‑order methods are your optimization workhorses. EM turns missingness into a tractable expectation–maximization cycle and increases the log‑likelihood monotonically. Linkage is about family transmissions; association is about population correlation. And <span class="math inline">\(r^2\)</span> is the currency that converts LD into expected association signal.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="hands-on-lab-03-applied" class="slide level2">
<h2>Hands-On: Lab 03 (Applied)</h2>
<ul>
<li>Implement ABO EM and compare starts; plot log-likelihood gap.</li>
<li>Two-point linkage: LOD grid search + EM with unknown phase.</li>
<li>Two-SNP haplotype EM; compute LD (D, r^2).</li>
<li>Mini association demo: linear regression + HWE QC in controls.</li>
</ul>
<p>See <code>labs/unsolved/lab-03.R</code> for the scaffold (with TODOs) and <code>labs/solved/lab-03.R</code> for a worked solution.</p>
<aside class="notes">
<p><strong>Script:</strong><br>
“For the lab: keep a log of starting values and attained log‑likelihoods—this is good hygiene with EM. In the two‑point EM, verify that ambiguous transmissions are being split sensibly as <span class="math inline">\(\theta\)</span> and <span class="math inline">\(w\)</span> update. In the haplotype EM, watch for boundary estimates at very low MAFs. And in the association mini‑demo, confirm that including PCs meaningfully reduces ancestry structure before you trust the p‑values.”</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>