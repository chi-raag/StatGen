---
title: "Assignment 02"
subtitle: "PUBH 8878: Heritability, Segregation, and Gene Mapping Theory"
format: 
  html:
    html-math-method: katex
  pdf: default
  docx: default
format-links: [pdf, docx]
draft: true
bibliography: references.bib
csl: https://www.zotero.org/styles/biostatistics
---

*Due: \[Date TBD\]*

**Requirements:**

-   Show all mathematical work
-   Submit well-documented R code with clear comments
-   Interpret results in biological context
-   Submit *pdf* rendered output, not the source `.qmd` file

## Problem 1: Missing Heritability and Rare Variants (10 points)

Recall [@young2019]: "The first challenge is one of precision. The information used to estimate heritability from rare variants by GREML-WGS comes from the variation in sharing of rare variants among distantly related pairs of individuals. However, distantly related individuals typically do not share any particular rare variant, so the variation in rare variant sharing is low. This means that large samples with high quality WGS data are required to obtain precise estimates, and such samples are not common yet. Based on the only existing application of GREML-WGS, a sample size of \~40,000 would produce estimates precise enough to be statistically distinguished from other heritability estimates. It is likely that this challenge will be overcome shortly, since samples of similar magnitude already exist."

1.  Assume the probability that two distantly related individuals share a rare variant is $p=0.001$. Assume a sample size of $n=40,000$ individuals.
    a.  Calculate the expected number of pairs of individuals in this sample who share a rare variant. How many total pairs of individuals exist in the sample?
    b.  If we estimate that rare variants contribute $h^2_{\text{rare}}=0.10$ to heritability, calculate the standard error of this estimate given the sample size. Use the formula $\text{SE}(h^2) \approx \frac{2}{\sqrt{n_{\text{eff}}}}$, where $n_{\text{eff}}$ is the effective number of independent observations (approximately the number of pairs sharing rare variants).
    c.  Calculate a 95% confidence interval for the heritability estimate. Does this confidence interval allow us to distinguish between $h^2_{\text{rare}}=0.10$ and $h^2_{\text{common}}=0.25$
2.  Briefly explain in 2-3 sentences how the "missing heritability" problem relates to rare variants, and why larger samples with whole-genome sequencing may be needed to resolve this question.

## Problem 2: Parent–Offspring Regression for $h^2$ (15 points)

Use the Lab 02 scaffold to simulate a quantitative trait on the pedigree (see `labs/unsolved/lab-02.R`, Sections 1–2) and estimate heritability from mid-parent regression.

1.  Construct a data set with columns `fam`, `midparent` (mean of father/mother phenotypes), and `child` (one row per child). Fit `lm(child ~ midparent)`.
2.  Report the estimated slope $\hat\beta$ and its 95% CI. Compute $\hat h^2 = \hat\beta$ for mid-parent regression (justify briefly from lecture notes) and give a 95% CI for $h^2$ by transforming the CI for $\beta$.
3.  Compare $\hat h^2$ to the simulation truth used in your code. Give one sentence on a factor that could bias this estimator in real data.

## Problem 3: Pedigree LMM (Variance Components) (15 points)

Fit an “animal model” with an additive relationship matrix using `lme4qtl::relmatLmer` (see `labs/solved/lab-02.R`). .

1.  Fit `y ~ age + sex01 + (1|id_factor)` with `relmat = list(id_factor = A)` on your simulated data. Extract $\hat\sigma^2_A$ and $\hat\sigma^2_E$ and report $\hat h^2 = \hat\sigma^2_A/(\hat\sigma^2_A+\hat\sigma^2_E)$.
2.  Obtain a 95% bootstrap CI for $h^2$ using `bootMer` (100–500 resamples is fine). Compare to the true simulation value.
3.  In 2–3 sentences, explain why a standard $\chi^2_1$ LRT is invalid for testing $H_0\!:\,\sigma_A^2=0$. What is the appropriate asymptotic null distribution from lecture, and why?

## Problem 4: Twins Estimator (ACE Heuristics) (15 points)

1.  Derive Falconer's formula for twins heritability $h^2 = 2(r_{\text{MZ}} - r_{\text{DZ}})$ from the ACE model, assuming MZ twins share all their additive genetics and DZ twins share half. Note that

-   $Y_MZ = A + C + E$
-   $Y_DZ = 0.5A + C + E$
-   $r_MZ = \operatorname{Corr}(Y_MZ1, Y_MZ2)$
-   $r_DZ = \operatorname{Corr}(Y_DZ1, Y_DZ2)$
-   $\operatorname{Corr}(X, Y) = \frac{\operatorname{Cov}(X, Y)}{\sqrt{\operatorname{Var}(X)\operatorname{Var}(Y)}}$

## Problem 5: Binary Traits and Liability-Threshold (20 points)

Simulate a binary trait from a liability-threshold model on the pedigree as in the lab (`simulate_binary_from_liability`). Let population prevalence be $K$ and sample prevalence be $P$.

1.  Fit an intercept-only probit GLM `glm(case ~ 1, family = binomial(link = "probit"))`. Recover $\hat K$ from the fitted intercept and verify it matches the empirical prevalence.
2.  Construct a mid-parent/offspring data set for the binary trait and fit a probit regression of child on mid-parent. Report the slope and use lecture logic to interpret $\hat h^2$ on the liability scale. Provide a simple bootstrap CI.
3.  Using the formulas from lecture, convert between observed-scale and liability-scale heritability:
    -   Unascertained case ($P=K$): $h_{\text{obs}}^2 \approx h_\ell^2\,\phi(T)^2/[K(1-K)]$ with $T=\Phi^{-1}(1-K)$.
    -   Case–control sampling ($P \ne K$): $h_\ell^2 \approx h_{\text{obs}}^2\,K^2(1-K)^2/[\phi(T)^2\,P(1-P)]$. Compute both and comment on how low $K$ affects $h_{\text{obs}}^2$.

## Problem 6: Ascertainment and Recurrence Risk (15 points)

1.  Ascertainment as conditioning: In 2–3 sentences, explain why analyzing a case–control sample as if it were a random sample biases prevalence and regression parameters, and how the truncation view corrects the likelihood.
2.  Using your simulated binary data, restrict to families with at least one affected child (probands). Re-estimate the probit intercept-only model on this ascertained sample and compare $\hat K$ to the true $K$.
3.  Estimate the sibling recurrence risk ratio $\lambda_R = \Pr(\text{sib affected} \mid \text{proband affected})/K$ empirically from your simulated families. Report your estimate and a brief interpretation.

## Problem 7: Segregation Analysis — Likelihood Basics (10 points)

1.  Consider a dominant model with a single heterozygous parent ($Dd\times dd$) and penetrance $f$ for genotype $D\cdot$. For a family with $n$ children and $n_A$ affected, write the binomial likelihood and log-likelihood for $f$ and show that the MLE is $\hat f = n_A/n$.
2.  Now suppose you observe five such families with counts $(n, n_A)$ equal to $(3,2)$, $(4,1)$, $(5,3)$, $(2,1)$, $(6,2)$. Compute the MLE $\hat f$ pooling across families and give a Wald 95% CI.
3.  Very briefly list two pitfalls in segregation analysis highlighted in lecture (e.g., reduced penetrance, phenocopies, ascertainment, or HWE assumptions).

------------------------------------------------------------------------

Submission checklist:

-   Code: Include commented R code for Problems 2, 3, 4, 5, and 6. You may adapt from `labs/unsolved/lab-02.R` and cite any external code you used.
-   Math: Show algebra for Problems 1 and 7.
-   Interpretation: For each numeric answer, add 1–2 sentence interpretation in context.
-   Deliverable: Render and submit the PDF, not the source `.qmd`.